!function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(r,o,function(n){return e[n]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="/",t(t.s=13)}([function(e,n){e.exports=require("debug")},function(e,n){e.exports=require("mongoose")},function(e,n){e.exports=require("jsonwebtoken")},function(e,n){e.exports=require("path")},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("mongoose-geojson-schema")},function(e,n){e.exports=require("@turf/turf")},function(e,n){e.exports=require("body-parser")},function(e,n){e.exports=require("cookie-parser")},function(e,n){e.exports=require("cors")},function(e,n){e.exports=require("email-validator")},function(e,n){e.exports=require("fs")},function(e,n,t){"use strict";var r=t(0),o=t.n(r),i=t(4),a=t(10),u=t.n(a);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e){var n={};return new Promise((function(t){e.forEach((function(r,o){r.required&&!r.value?n["".concat(r.name)]="".concat(r.name," is required"):r.minLength&&r.value.length<r.minLength?n["".concat(r.name)]="".concat(r.name," should have more than ").concat(r.minLength," characters"):r.maxLength&&r.value.maxLength>r.maxLength?n["".concat(r.name)]="".concat(r.name," should have less than ").concat(r.maxLength," characters"):r.length&&"object"!==r.type&&r.value.length!==r.length?n["".concat(r.name)]="".concat(r.name," should have ").concat(r.length," characters"):r.type&&s(r.value)!==r.type?n["".concat(r.name)]="".concat(r.name," type should ba ").concat(r.type):r.email&&!1===u.a.validate(r.value)?n["".concat(r.name)]="".concat(r.name," is invalid"):"object"===r.type?r.length&&Object.keys(r.value).length!==r.length&&(n["".concat(r.name)]="".concat(r.name," object length should be ").concat(r.length)):"object"===r.type?r.keys.forEach((function(e){r.value[e.name]||(n["".concat(r.name)]="".concat(e.name," should be a part of ").concat(r.name))})):"object"===r.type&&r.keys.forEach((function(e){s(r.value[e.name])!==e.type&&(n["".concat(r.name)]="".concat(e.name," type should be ").concat(e.type))})),o===e.length-1&&t(n)}))}))}var l=function(e){return c([{value:e.from,name:"from",required:!0,type:"string"},{value:e.email,name:"email",email:!0},{value:e.firstname,name:"firstname",required:!0,type:"string"},{value:e.lastname,name:"lastname",required:!0,type:"string"},{value:e.fullname,name:"fullname",required:!0,type:"string"},{value:e.thumbnail,name:"thumbnail",required:!0,type:"string"},{value:e.googleId||e.facebookId,name:"id",required:!0,type:"string"},{value:e.location,name:"location",required:!0,type:"object",length:2,keys:[{value:"lng",type:"number"},{value:"lat",type:"number"}]},{value:e.address,name:"address",required:!0,type:"string"},{value:e.birth,name:"birth",required:!0},{value:e.gender,name:"gender",required:!0,type:"string"}])},f=t(6),d=t(2),p=t.n(d),m=t(1),g=t.n(m),v=(t(5),new m.Schema({geo:{type:m.Schema.Types.Point,required:!0},address:{type:String,required:!0},email:{type:String,required:!0,unique:!0},fullname:{type:String},firstname:{type:String},lastname:{type:String},thumbnail:{type:String},picture:{type:String},birth:{type:Date,required:!0},gender:{type:String,required:!0},facebookId:{type:String},googleId:{type:String},activatedOn:{type:Date,default:new Date},likes:[{type:m.Schema.Types.ObjectId,ref:"Team"}],dislikes:[{type:m.Schema.Types.ObjectId,ref:"Team"}],suggests:[{type:m.Schema.Types.ObjectId,ref:"Suggest"}]})),h=Object(m.model)("User",v),y=o()("log:db:makeNewuser"),b=function(e,n){y("-------------------------------------------",process.env.TOKEN);var t=e.from,r=e.email,o=e.firstname,i=e.lastname,a=e.fullname,u=e.picture,s=e.thumbnail,c=e.googleId,l=e.facebookId,d=e.location,m=e.address,g=e.birth,v=e.gender,b=f.point([d.lng,d.lat]),x=new h({geo:b.geometry,address:m,email:r,fullname:a,firstname:o,lastname:i,thumbnail:s,picture:u,birth:new Date(g),gender:v});"google"===t&&(x.googleId=c),"facebook"===t&&(x.facebookId=l);try{x.save((function(e,t){return e?(y("save err",e),11e3===e.code?n(500,{other:"email should be unique"}):n(500,{other:"Internal Server Error"})):(p.a.sign({email:t.email,id:t._id},process.env.TOKEN,(function(e,r){return e?(y("error on creating token",e),n(500,{other:"Server Internal Error"})):(y("++++++++++++++++++++++",r),n(200,{token:r,snackMsg:"hello ".concat(t.firstname)}))})),null)}))}catch(e){return y("eeeeeeeeeeeeeeeeeeeeee",e),n(500,{other:"Internal Server Error"})}};function x(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function k(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){x(i,r,o,a,u,"next",e)}function u(e){x(i,r,o,a,u,"throw",e)}a(void 0)}))}}var w=o()("log:v1");function S(){return(S=k(regeneratorRuntime.mark((function e(n,t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("make ne user is :::",n),e.next=3,l(n);case 3:if(r=e.sent,w("test isNewUser",r),!Object.entries(r).length){e.next=7;break}return e.abrupt("return",t(400,{test:r}));case 7:return b(n,(function(e,n){return t(e,n)})),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O=function(e){return c([{value:e,name:"email",required:!0,email:!0}])},_=o()("log:db");function T(e,n){_("gert user by email is working",e),h.findOne({email:e},(function(e,t){return _("getUserByEmail result",e,t),e?n(e,null):n(null,t)}))}function P(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function q(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){P(i,r,o,a,u,"next",e)}function u(e){P(i,r,o,a,u,"throw",e)}a(void 0)}))}}var R=o()("log:v1");function j(){return(j=q(regeneratorRuntime.mark((function e(n,t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.email,e.next=3,O(r);case 3:if(o=e.sent,R("test isNewUser",o),!Object.entries(o).length){e.next=7;break}return e.abrupt("return",t(400,o));case 7:return T(r,(function(e,n){return t(200,e?{err:!0,other:"Internal Server Error"}:n?{err:!0,other:"Account exists"}:{msg:"New User"})})),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=function(e){return c([{value:e,name:"facebook id",required:!0}])};function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}o()("log:db");function E(e,n){console.log("-----",C(e)),console.log("gert user by facebookId is working",e),h.findOne(e,(function(e,t){return console.log("getUserByFacebookID result",e,t),e?n(e,null):n(null,t)}))}function A(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function D(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){A(i,r,o,a,u,"next",e)}function u(e){A(i,r,o,a,u,"throw",e)}a(void 0)}))}}var N=o()("log:v1");function U(){return(U=D(regeneratorRuntime.mark((function e(n,t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.facebookId,e.next=3,I(r);case 3:if(o=e.sent,N("test isNewUser",o),!Object.entries(o).length){e.next=7;break}return e.abrupt("return",t(400,o));case 7:return E({facebookId:r},(function(e,n){return t(200,e?{err:!0,other:"Internal Server Error"}:n?{err:!0,other:"Account exists"}:{msg:"New User"})})),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var L=o()("log:db");function M(e,n){L("gert user by email is working",e);var t={};Object.facebookId?t.facebookId=e.facebookId:t.googleId=e.googleId,h.findOne(t).exec((function(e,t){return e?n(e,null):n(null,t)}))}function F(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function $(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){F(i,r,o,a,u,"next",e)}function u(e){F(i,r,o,a,u,"throw",e)}a(void 0)}))}}var B=o()("log:v1");function W(){return(W=$(regeneratorRuntime.mark((function e(n,t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.facebookId,o=n.googleId,M({facebookId:r,googleId:o},(function(e,n){return B("result of population ==> ",e,n),e?t(500,{other:"Server Internal Error"}):n?(p.a.sign({email:n.email,id:n._id},process.env.TOKEN,(function(r,o){return e?(B("error on creating token",r),t(500,{other:"Server Internal Error"})):t(200,{token:o,snackMsg:"hello ".concat(n.firstname,", you signed in with ").concat(n.email),firstname:n.firstname,lastname:n.lastname,likes:n.likes||null,dislikes:n.dislikes||null,suggests:n.suggests||null,location:n.geo,from:n.googleId?"google":"facebook",thumbnail:n.thumbnail})})),null):t(400,{other:"no user has been found"})})),e.abrupt("return",null);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}o()("log:db");function K(e,n){h.findById(e).populate("likes").populate("dislikes").exec((function(e,t){return e?n(e,null):n(null,t)}))}var H=o()("log:v1");var X=function(e){return c([{value:e.str,name:"str",required:!0,type:"string"}])},G=new m.Schema({group:{type:String,required:!0},country:{type:String,required:!0},name:{type:String,required:!0},city:{type:String},primary_color:{type:String,required:!0},secondary_color:{type:String,required:!0}});G.index({name:1});var z=Object(m.model)("Team",G);o()("log:db");function J(e,n){z.find({name:{$regex:"^".concat(e,".*"),$options:"i"}}).sort({name:1}).limit(10).exec((function(e,t){e?n(e,null):n(null,t)}))}function Q(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function V(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){Q(i,r,o,a,u,"next",e)}function u(e){Q(i,r,o,a,u,"throw",e)}a(void 0)}))}}o()("log:v1");function Y(){return(Y=V(regeneratorRuntime.mark((function e(n,t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(n);case 2:if(r=e.sent,!Object.entries(r).length){e.next=5;break}return e.abrupt("return",t(400,{test:r}));case 5:return J(n.str,(function(e,n){return e?t(500,{other:"Server Internal Error"}):t(200,{clubs:n})})),e.abrupt("return",null);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=new m.Schema({geo:m.Schema.Types.Point,user_id:{type:String},boundy_id:{type:String},team_id:{type:String},name0:{type:String},name1:{type:String},name2:{type:String},fid:{type:Number,require:!0},date:{type:Date,default:new Date},gender:{type:String}});Z.index({geo:"2dsphere"}),Z.index({user_id:1}),Z.index({boundy_id:1}),Z.index({team_id:1}),Z.index({fid:1}),Z.index({date:1}),Z.index({gender:1});var ee=Object(m.model)("Like",Z),ne=function(e){return c([{value:e.token,name:"token",required:!0,type:"string"},{value:e.club,name:"club",required:!0,type:"object",keys:[{value:"_id",type:"string"},{value:"group",type:"string"},{value:"name",type:"string"},{value:"city",type:"string"},{value:"primary_color",type:"string"},{value:"secondary_color",type:"string"}]}])},te=new m.Schema({name0:{type:String},name1:{type:String},name2:{type:String},geo:m.Schema.Types.MultiPolygon,fid:{type:Number,required:!0}});te.index({geo:"2dsphere"}),te.index({fid:1});var re=Object(m.model)("GeoJSON",te);function oe(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function ie(e,n){re.find({geo:{$geoIntersects:{$geometry:{type:e.type,coordinates:e.coordinates}}}},function(){var e,t=(e=regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return",n(t,{msg:"Server Internal Error"}));case 2:return e.abrupt("return",n(null,{array:r}));case 3:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){oe(i,r,o,a,u,"next",e)}function u(e){oe(i,r,o,a,u,"throw",e)}a(void 0)}))});return function(e,n){return t.apply(this,arguments)}}())}function ae(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function ue(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){ae(i,r,o,a,u,"next",e)}function u(e){ae(i,r,o,a,u,"throw",e)}a(void 0)}))}}var se=o()("log:v1");function ce(){return(ce=ue(regeneratorRuntime.mark((function e(n,t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne(n);case 2:if(r=e.sent,se("test searchClubs",r),!Object.entries(r).length){e.next=6;break}return e.abrupt("return",t(400,{test:r}));case 6:return o=n.token,p.a.verify(o,process.env.TOKEN,(function(e,r){if(e)return t(500,{other:"Server Internal Error"});K(r.id,function(){var e=ue(regeneratorRuntime.mark((function e(r,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se("----------------------",o),!r){e.next=3;break}return e.abrupt("return",t(500,{other:"Server Internal Error"}));case 3:if(o){e.next=5;break}return e.abrupt("return",t(400,"User doesnt exist"));case 5:if(!(o.likes.length>=5)){e.next=7;break}return e.abrupt("return",t(403,"you can like more than 5 clubs"));case 7:return e.next=9,o.likes.find((function(e){return e._id==n.club._id}));case 9:if(!e.sent){e.next=12;break}return e.abrupt("return",t(403,{other:"you already liked this club"}));case 12:return e.next=14,o.dislikes.find((function(e){return e._id==n.club._id}));case 14:if(!e.sent){e.next=17;break}return e.abrupt("return",t(403,{other:"you can likes clubs you already disliked"}));case 17:return ie(o.geo,function(){var e=ue(regeneratorRuntime.mark((function e(r,i){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se("findBoundries",o.geo,r,i),!r){e.next=3;break}return e.abrupt("return",t(500,{other:"Server Internal Error"}));case 3:if(i.array.length){e.next=5;break}return e.abrupt("return",t(400,{msg:"unable to resolve coordinates"}));case 5:return e.next=7,g.a.startSession();case 7:return(a=e.sent).startTransaction(),e.prev=9,e.next=12,i.array.forEach((function(e){console.log("...........................",e),new ee({name0:e.name0,name1:e.name1,name2:e.name2,user_id:o._id,boundy_id:e._id,team_id:n.club._id,geo:o.geo,fid:e.fid,gender:o.gender}).save()}));case 12:return o.likes.push(n.club._id),e.next=15,o.save();case 15:return e.next=17,a.commitTransaction();case 17:return e.next=19,a.endSession();case 19:return e.abrupt("return",null);case 22:return e.prev=22,e.t0=e.catch(9),e.next=26,a.abortTransaction();case 26:return a.endSession(),e.abrupt("return",t(500,{msg:"internal error"}));case 28:return e.prev=28,K(o._id,(function(e,n){return e?t(500,{msg:"internal error"}):t(200,{snackMsg:"hello ".concat(n.firstname),firstname:n.firstname,lastname:n.lastname,likes:n.likes||null,dislikes:n.dislikes||null,suggests:n.suggests||null,location:n.geo})})),e.finish(28);case 31:case"end":return e.stop()}}),e,null,[[9,22,28,31]])})));return function(n,t){return e.apply(this,arguments)}}()),e.abrupt("return",null);case 19:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}())})),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var le=new m.Schema({geo:m.Schema.Types.Point,user_id:{type:String},boundy_id:{type:String},team_id:{type:String},name0:{type:String},name1:{type:String},name2:{type:String},fid:{type:Number,require:!0},date:{type:Date,default:new Date},gender:{type:String}});le.index({geo:"2dsphere"}),le.index({user_id:1}),le.index({boundy_id:1}),le.index({team_id:1}),le.index({fid:1}),le.index({date:1}),le.index({gender:1});var fe=Object(m.model)("Dislike",le);function de(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function pe(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){de(i,r,o,a,u,"next",e)}function u(e){de(i,r,o,a,u,"throw",e)}a(void 0)}))}}var me=o()("log:v1"),ge=function(e){return c([{value:e.token,name:"token",required:!0,type:"string"},{value:e.club,name:"club",required:!0,type:"object",keys:[{value:"_id",type:"string"},{value:"group",type:"string"},{value:"name",type:"string"},{value:"city",type:"string"},{value:"primary_color",type:"string"},{value:"secondary_color",type:"string"}]}])};function ve(){return(ve=pe(regeneratorRuntime.mark((function e(n,t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ge(n);case 2:if(r=e.sent,me("test searchClubs",r),!Object.entries(r).length){e.next=6;break}return e.abrupt("return",t(400,{test:r}));case 6:return o=n.token,p.a.verify(o,process.env.TOKEN,(function(e,r){if(e)return t(500,{other:"Server Internal Error"});K(r.id,function(){var e=pe(regeneratorRuntime.mark((function e(r,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=2;break}return e.abrupt("return",t(500,{other:"Server Internal Error"}));case 2:if(o){e.next=4;break}return e.abrupt("return",t(400,"User doesnt exist"));case 4:if(!(o.dislikes.length>=5)){e.next=6;break}return e.abrupt("return",t(403,"you can dislike more than 5 clubs"));case 6:return e.next=8,o.likes.find((function(e){return e._id==n.club._id}));case 8:if(!e.sent){e.next=11;break}return e.abrupt("return",t(403,{other:'you can"t dislikes clubs you already liked'}));case 11:return e.next=13,o.dislikes.find((function(e){return e._id==n.club._id}));case 13:if(!e.sent){e.next=16;break}return e.abrupt("return",t(403,{other:"you already disliked this club"}));case 16:return ie(o.geo,function(){var e=pe(regeneratorRuntime.mark((function e(r,i){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(me("findBoundries",o.geo,r,i),!r){e.next=3;break}return e.abrupt("return",t(500,{other:"Server Internal Error"}));case 3:if(i.array.length){e.next=5;break}return e.abrupt("return",t(400,{msg:"unable to resolve coordinates"}));case 5:return e.next=7,g.a.startSession();case 7:return(a=e.sent).startTransaction(),e.prev=9,e.next=12,i.array.forEach((function(e){new fe({name0:e.name0,name1:e.name1,name2:e.name2,user_id:o._id,boundy_id:e._id,team_id:n.club._id,geo:o.geo,fid:e.fid,gender:o.gender}).save()}));case 12:return o.dislikes.push(n.club._id),e.next=15,o.save();case 15:return e.next=17,a.commitTransaction();case 17:return e.next=19,a.endSession();case 19:return e.abrupt("return",null);case 22:return e.prev=22,e.t0=e.catch(9),e.next=26,a.abortTransaction();case 26:return a.endSession(),e.abrupt("return",t(500,{msg:"internal error"}));case 28:return e.prev=28,K(o._id,(function(e,n){return e?t(500,{msg:"internal error"}):t(200,{snackMsg:"hello ".concat(n.firstname),firstname:n.firstname,lastname:n.lastname,likes:n.likes||null,dislikes:n.dislikes||null,suggests:n.suggests||null,location:n.geo})})),e.finish(28);case 31:case"end":return e.stop()}}),e,null,[[9,22,28,31]])})));return function(n,t){return e.apply(this,arguments)}}()),e.abrupt("return",null);case 18:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}())})),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function ye(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){he(i,r,o,a,u,"next",e)}function u(e){he(i,r,o,a,u,"throw",e)}a(void 0)}))}}var be=o()("log:v1");function xe(e,n,t,r){return new Promise((function(o,i){"like"===t?ee.countDocuments({team_id:n,gender:r,date:{$gte:new Date(e[0]),$lte:new Date(e[1])}}).exec((function(e,n){e&&(be("geoWithin err",e),i(e)),o(n)})):fe.countDocuments({team_id:n,gender:r,date:{$gte:new Date(e[0]),$lte:new Date(e[1])}}).exec((function(e,n){e&&(be("geoWithin err",e),i(e)),o(n)}))}))}var ke=t(11),we=t.n(ke),Se=new m.Schema({country:{type:String},name:{type:String},geo:m.Schema.Types.Point,cn:{type:String,unique:!0}});Se.index({geo:"2dsphere"}),Se.index({name:1}),Se.index({country:1}),Se.index({cn:1});var Oe=Object(m.model)("City",Se);function _e(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}o()("log:v1");function Te(e,n){z.findById(e,(function(e,t){if(e)return console.log("error on finding club \n ".concat(e)),n(500,"error on finding club");var r=t.city,o=t.group,i=t.country,a=t.name;if("AFC"!==o||!i||!r)return n(200,t);we.a.readFile("/root/repos/fans_club/routes/logo/".concat(i+r+a,".png"),(function(e,o){if(e)return console.log("---------------------",e),n(200,{club:t,errRead:e});Oe.findOne({country:i.trim(),name:r.trim()},function(){var e,r=(e=regeneratorRuntime.mark((function e(r,i){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=3;break}return console.log("--------------- finding City",r),e.abrupt("return",n(200,{club:t,errCity:r}));case 3:if(i){e.next=6;break}return console.log("--------------- no city has been found",i),e.abrupt("return",n(200,{club:t,errCity:null}));case 6:return a=Buffer.from(o).toString("base64"),e.abrupt("return",n(200,{city:i,club:t,base64Image:a}));case 8:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){_e(i,r,o,a,u,"next",e)}function u(e){_e(i,r,o,a,u,"throw",e)}a(void 0)}))});return function(e,n){return r.apply(this,arguments)}}())}))}))}var Pe=o()("log:v1__serverTiles"),qe=t(16),Re={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/x-protobuf"},je={"Content-Type":"text/plain"};o()("log:v1");function Ie(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}o()("log:v1");function Ce(e){var n=e.likeOrDislike,t=e.reducedDuplicates,r=e.teamId,o={},i=function(e){return e<1e3?e:e<1e4?e+1e3:e+1e4};return new Promise((function(e,a){try{t.forEach(function(){var a,u=(a=regeneratorRuntime.mark((function a(u,s){var c,l;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if("like"!==n){a.next=7;break}return c=i(u),console.log(c),a.next=5,ee.countDocuments({fid:c,team_id:r},(function(e,n){e&&console.log(e),o[u]=n}));case 5:a.next=11;break;case 7:return l=i(u),console.log(l),a.next=11,fe.countDocuments({fid:l,team_id:r},(function(e,n){e&&console.log(e),o[u]=n}));case 11:t.length-1===s&&e(o);case 12:case"end":return a.stop()}}),a)})),function(){var e=this,n=arguments;return new Promise((function(t,r){var o=a.apply(e,n);function i(e){Ie(o,t,r,i,u,"next",e)}function u(e){Ie(o,t,r,i,u,"throw",e)}i(void 0)}))});return function(e,n){return u.apply(this,arguments)}}())}catch(e){a(e)}}))}function Ee(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function Ae(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){Ee(i,r,o,a,u,"next",e)}function u(e){Ee(i,r,o,a,u,"throw",e)}a(void 0)}))}}o()("log:v1");function De(){return(De=Ae(regeneratorRuntime.mark((function e(n,t){var r,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.token,o=n.club,i=n.type,p.a.verify(r,process.env.TOKEN,(function(e,n){if(e)return t(500,{other:"Server Internal Error"});K(n.id,function(){var e=Ae(regeneratorRuntime.mark((function e(n,r){var a,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=2;break}return e.abrupt("return",t(500,{other:"Server Internal Error"}));case 2:if(r){e.next=4;break}return e.abrupt("return",t(400,"User doesnt exist"));case 4:return e.next=6,g.a.startSession();case 6:return(a=e.sent).startTransaction(),e.prev=8,e.next=11,r.save();case 11:if("like"!==i){e.next=21;break}return e.next=14,r.likes.filter((function(e){return e._id!=o._id}));case 14:return u=e.sent,r.likes=u,e.next=18,r.save();case 18:return e.next=20,ee.deleteMany({user_id:r._id,team_id:o._id});case 20:K(r._id,(function(e,n){return e?t(500,{msg:"internal error"}):t(200,{firstname:n.firstname,lastname:n.lastname,likes:n.likes||null,dislikes:n.dislikes||null,suggests:n.suggests||null,location:n.geo})}));case 21:if("dislike"!==i){e.next=31;break}return e.next=24,r.dislikes.filter((function(e){return e._id!=o._id}));case 24:return s=e.sent,r.dislikes=s,e.next=28,r.save();case 28:return e.next=30,fe.deleteMany({user_id:r._id,team_id:o._id});case 30:K(r._id,(function(e,n){return e?t(500,{msg:"internal error"}):t(200,{firstname:n.firstname,lastname:n.lastname,likes:n.likes||null,dislikes:n.dislikes||null,suggests:n.suggests||null,location:n.geo})}));case 31:return e.next=33,a.commitTransaction();case 33:return e.next=35,a.endSession();case 35:e.next=43;break;case 37:return e.prev=37,e.t0=e.catch(8),e.next=41,a.abortTransaction();case 41:return a.endSession(),e.abrupt("return",t(500,{msg:"internal error"}));case 43:case"end":return e.stop()}}),e,null,[[8,37]])})));return function(n,t){return e.apply(this,arguments)}}())})),e.abrupt("return",null);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ne=new m.Schema({username:{type:String},password:{type:String}}),Ue=Object(m.model)("Admin",Ne);function Le(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function Me(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){Le(i,r,o,a,u,"next",e)}function u(e){Le(i,r,o,a,u,"throw",e)}a(void 0)}))}}function Fe(){return(Fe=Me(regeneratorRuntime.mark((function e(n,t,r){var o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("=============",n,t),n&&t){e.next=3;break}return e.abrupt("return",r(200,{err:!0,other:"bad request"}));case 3:return o={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},i={"Content-Type":"text/plain"},Ue.findOne({username:n,password:t},(function(e,a){return console.log("************ ",e,a),e?r(200,i,{err:!0,other:"server internal error"}):a?void p.a.sign({username:n,password:t},process.env.TOKEN,(function(e,n){return e?r(200,i,{err:!0,other:"internal server error"}):(console.log(n),r(200,o,{err:!1,token:n}))})):r(200,i,{err:!0,other:"no uwer had been found"})})),e.abrupt("return",null);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $e(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function Be(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){$e(i,r,o,a,u,"next",e)}function u(e){$e(i,r,o,a,u,"throw",e)}a(void 0)}))}}function We(){return(We=Be(regeneratorRuntime.mark((function e(n,t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",t(200,{err:!0,other:"bad request"}));case 2:return r={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},o={"Content-Type":"text/plain"},p.a.verify(n,process.env.TOKEN,(function(e,n){if(console.log(e,n),e)return t(200,o,{err:!0,other:"internal server error"});Ue.findOne({username:n.username},(function(e,n){return e?t(200,o,{err:!0,other:"internal server error"}):n?t(200,r,{err:!1,isAdmin:!0}):t(200,o,{err:!0,other:"no user had been fround"})}))})),e.abrupt("return",null);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ke=Object(i.Router)();Ke.get("/verify/:username/:password",(function(e,n){!function(e,n,t){Fe.apply(this,arguments)}(e.params.username,e.params.password,(function(e,t,r){n.set(t).status(e).send({trace:r})}))})),Ke.get("/verifyByToken/:token",(function(e,n){console.log("got the req",e.params.token),function(e,n){We.apply(this,arguments)}(e.params.token,(function(e,t,r){n.set(t).status(e).send({trace:r})}))}));var He=Ke;function Xe(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}var Ge={"Content-Type":"text/plain"},ze=function(){var e,n=(e=regeneratorRuntime.mark((function e(n,t,r){var o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.params||n.body,i=o.token,console.log("-_________________",i),p.a.verify(i,process.env.TOKEN,(function(e,n){console.log(e,n),e&&t.set(Ge).status(200).send({err:!0,other:"internal server error"}),Ue.findOne({username:n.username},(function(e,n){e&&t.set(Ge).status(200).send({err:!0,other:"internal server error"}),n||t.set(Ge).status(200).send({err:!0,other:"no user had been fround"}),r()}))}));case 3:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){Xe(i,r,o,a,u,"next",e)}function u(e){Xe(i,r,o,a,u,"throw",e)}a(void 0)}))});return function(e,t,r){return n.apply(this,arguments)}}();function Je(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function Qe(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){Je(i,r,o,a,u,"next",e)}function u(e){Je(i,r,o,a,u,"throw",e)}a(void 0)}))}}var Ve={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},Ye={"Content-Type":"text/plain"};function Ze(){return(Ze=Qe(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:z.countDocuments({},(function(e,t){return e?n(200,Ye,{err:!0,other:"internal server error"}):n(200,Ve,{err:!1,count:t})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function en(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function nn(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){en(i,r,o,a,u,"next",e)}function u(e){en(i,r,o,a,u,"throw",e)}a(void 0)}))}}var tn={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},rn={"Content-Type":"text/plain"};function on(){return(on=nn(regeneratorRuntime.mark((function e(n,t){var r,o,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ee.countDocuments({team_id:n});case 3:return r=e.sent,e.next=6,fe.countDocuments({team_id:n});case 6:return o=e.sent,e.next=9,ee.find({fid:{$lt:1e3}}).sort({date:1}).limit(10).exec();case 9:return i=e.sent,e.next=12,fe.find({fid:{$lt:1e3}}).sort({date:1}).limit(10).exec();case 12:return a=e.sent,console.log({countDislikes:o,countLikes:r,latestDislikes:a,latestLikes:i}),e.abrupt("return",t(200,tn,{err:!1,countDislikes:o,countLikes:r,latestDislikes:a,latestLikes:i}));case 17:return e.prev=17,e.t0=e.catch(0),e.abrupt("return",t(200,rn,{err:!0,other:"internal server error"}));case 20:case"end":return e.stop()}}),e,null,[[0,17]])})))).apply(this,arguments)}function an(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function un(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var sn=Object(i.Router)();sn.get("/count/:token",ze,(function(e,n){console.log("got the req"),function(e){Ze.apply(this,arguments)}((function(e,t,r){n.set(t).status(e).send({trace:r})}))})),sn.get("/details/:teamId/:token",ze,(function(e,n){console.log("got the req"),function(e,n){on.apply(this,arguments)}(e.params.teamID,(function(e,t,r){n.set(t).status(e).send(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?an(Object(t),!0).forEach((function(n){un(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):an(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},r))}))}));var cn=sn;function ln(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function fn(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){ln(i,r,o,a,u,"next",e)}function u(e){ln(i,r,o,a,u,"throw",e)}a(void 0)}))}}var dn={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},pn={"Content-Type":"text/plain"};function mn(){return(mn=fn(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h.countDocuments({},(function(e,t){return e?n(200,pn,{err:!0,other:"internal server error"}):n(200,dn,{err:!1,count:t})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var gn=Object(i.Router)();gn.get("/count/:token",ze,(function(e,n){console.log("got the req"),function(e){mn.apply(this,arguments)}((function(e,t,r){n.set(t).status(e).send({trace:r})}))}));var vn=gn;function hn(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function yn(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){hn(i,r,o,a,u,"next",e)}function u(e){hn(i,r,o,a,u,"throw",e)}a(void 0)}))}}var bn={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},xn={"Content-Type":"text/plain"};function kn(){return(kn=yn(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ee.countDocuments({},(function(e,t){return e?n(200,xn,{err:!0,other:"internal server error"}):n(200,bn,{err:!1,count:t})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var wn=Object(i.Router)();wn.get("/count/:token",ze,(function(e,n){console.log("got the req"),function(e){kn.apply(this,arguments)}((function(e,t,r){n.set(t).status(e).send({trace:r})}))}));var Sn=wn;function On(e,n,t,r,o,i,a){try{var u=e[i](a),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function _n(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){On(i,r,o,a,u,"next",e)}function u(e){On(i,r,o,a,u,"throw",e)}a(void 0)}))}}var Tn={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},Pn={"Content-Type":"text/plain"};function qn(){return(qn=_n(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fe.countDocuments({},(function(e,t){return e?n(200,Pn,{err:!0,other:"internal server error"}):n(200,Tn,{err:!1,count:t})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Rn=Object(i.Router)();Rn.get("/count/:token",ze,(function(e,n){console.log("got the req"),function(e){qn.apply(this,arguments)}((function(e,t,r){n.set(t).status(e).send({trace:r})}))}));var jn=Rn,In=o()("log:v1"),Cn=Object(i.Router)();Cn.post("/POST/makeNewUser",(function(e,n){!function(e,n){S.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Cn.post("/POST/isUserNew",(function(e,n){!function(e,n){j.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Cn.post("/POST/isUserNewFb",(function(e,n){!function(e,n){U.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Cn.post("/POST/signin",(function(e,n){!function(e,n){W.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Cn.get("/GET/getUserInfo/:token",(function(e,n){var t,r;In("getUesrInfo token is ==> ",e.params.token),t=e.params.token,r=function(e,t){n.status(e).send(t)},p.a.verify(t,process.env.TOKEN,(function(e,n){if(H("??????",e,n),e)return r(500,{other:"Server Internal Error"});K(n.id,(function(e,n){return e?r(500,{other:"Server Internal Error"}):n?r(200,{snackMsg:"hello ".concat(n.firstname),firstname:n.firstname,lastname:n.lastname,likes:n.likes||null,dislikes:n.dislikes||null,suggests:n.suggests||null,location:n.geo,thumbnail:n.thumbnail}):r(400,"User doesnt exist")}))}))})),Cn.post("/POST/searchClubs",(function(e,n){console.log(e.body),function(e,n){Y.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Cn.post("/POST/likeClub",(function(e,n){!function(e,n){ce.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Cn.post("/POST/dislikeClub",(function(e,n){!function(e,n){ve.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Cn.get("/GET/getClubTotalLikes/:mode/:id",(function(e,n){!function(e,n,t){var r=17424e5,o=[1580114579e3,1581856979e3],i=[o[1],o[1]+r],a=[i[1],i[1]+r],u=[a[1],a[1]+r],s=[u[1],u[1]+r],c=[s[1],s[1]+r];try{ye(regeneratorRuntime.mark((function r(){var l,f,d;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,ye(regeneratorRuntime.mark((function t(){var r,l,f,d,p,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,xe(o,e,n,"male");case 2:return r=t.sent,t.next=5,xe(i,e,n,"male");case 5:return t.t0=t.sent,t.t1=r,l=t.t0+t.t1,t.next=10,xe(a,e,n,"male");case 10:return t.t2=t.sent,t.t3=l,f=t.t2+t.t3,t.next=15,xe(u,e,n,"male");case 15:return t.t4=t.sent,t.t5=f,d=t.t4+t.t5,t.next=20,xe(s,e,n,"male");case 20:return t.t6=t.sent,t.t7=d,p=t.t6+t.t7,t.next=25,xe(c,e,n,"male");case 25:return t.t8=t.sent,t.t9=p,m=t.t8+t.t9,t.abrupt("return",[r,l,f,d,p,m]);case 29:case"end":return t.stop()}}),t)})))();case 2:return l=r.sent,r.next=5,ye(regeneratorRuntime.mark((function t(){var r,l,f,d,p,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,xe(o,e,n,"female");case 2:return r=t.sent,t.next=5,xe(i,e,n,"female");case 5:return t.t0=t.sent,t.t1=r,l=t.t0+t.t1,t.next=10,xe(a,e,n,"female");case 10:return t.t2=t.sent,t.t3=l,f=t.t2+t.t3,t.next=15,xe(u,e,n,"female");case 15:return t.t4=t.sent,t.t5=f,d=t.t4+t.t5,t.next=20,xe(s,e,n,"female");case 20:return t.t6=t.sent,t.t7=d,p=t.t6+t.t7,t.next=25,xe(c,e,n,"female");case 25:return t.t8=t.sent,t.t9=p,m=t.t8+t.t9,t.abrupt("return",[r,l,f,d,p,m]);case 29:case"end":return t.stop()}}),t)})))();case 5:return f=r.sent,r.next=8,z.findById(e,(function(e,n){return e?t(500,{msg:"Internal Serever Error"}):n}));case 8:return d=r.sent,r.abrupt("return",t(200,{males:l,females:f,team:d}));case 10:case"end":return r.stop()}}),r)})))()}catch(e){return be(e),t(500,{msg:"Internal Serever Error"})}}(e.params.id,e.params.mode,(function(e,t){n.status(e).send(t)}))})),Cn.get("/GET/tiles/:z/:x/:y",(function(e,n){var t=e.params;!function(e,n,t,r){console.log(e,n,t),new qe(e<4?"./mbTiles/0.mbtiles":e<7?"./mbTiles/1.mbtiles":"./mbTiles/2.mbtiles",(function(o,i){i.getTile(e,n,t,(function(e,n){return e?(Pe(e),r(404,je,"Tile rendering error: ".concat(e,"\n"))):r(200,Re,n)}))}))}(t.z,t.x,t.y,(function(e,t,r){console.log("sending tile"),200===e?n.set(t).status(e).send(r):n.sendStatus(204)}))})),Cn.get("/GET/membersFromPoly/:swlng/:swlat/:nelng/:nelat/:val/:teamId",(function(e,n){var t=e.params,r=t.swlng,o=t.swlat,i=t.nelng,a=t.nelat,u=t.val,s=t.teamId;console.log(r,o,i,a,u,s),function(e,n,t,r,o,i,a){console.log("........................",i);var u=[e,n,t,r],s=f.bboxPolygon(u);"like"===o?ee.find({team_id:i,geo:{$geoWithin:{$geometry:s.geometry}}},(function(e,n){return console.log(n),e?a(500,{msg:"Inernal Server Error"}):a(200,{likes:n})})):fe.find({team_id:i,geo:{$geoWithin:{$geometry:s.geometry}}},(function(e,n){return console.log(n),e?a(500,{msg:"Inernal Server Error"}):a(200,{likes:n})}))}(r,o,i,a,u,s,(function(e,t){n.status(e).send(t)}))})),Cn.post("/POST/getLikesForPolys",(function(e,n){var t,r;t=e.body,r=function(e,t){console.log("getLikesForPolys ......",t),n.status(e).send(t)},Ce(t).then((function(e){return console.time("process is done"),r(200,{likes:e})})).catch((function(e){return r(500,{msg:"Internal Server Error",e:e})}))})),Cn.get("/GET/club/:clubId",(function(e,n){Te(e.params.clubId,(function(e,t){n.status(e).send(t)}))})),Cn.post("/POST/deleteClub",(function(e,n){!function(e,n){De.apply(this,arguments)}(e.body,(function(e,t){In(e,t),n.status(e).send(t)}))})),Cn.use("/admin",He),Cn.use("/clubs",cn),Cn.use("/users",vn),Cn.use("/likes",Sn),Cn.use("/dislikes",jn);var En=Cn;n.a={v1:En}},function(e,n,t){"use strict";t.r(n),function(e){t(14);var n=t(4),r=t.n(n),o=t(8),i=t.n(o),a=t(7),u=t.n(a),s=t(9),c=t.n(s),l=t(3),f=t.n(l),d=t(0),p=t.n(d),m=t(1),g=t.n(m),v=(t(15),t(12)),h=p()("server"),y=process.env.PORT||4e3;g.a.connect("mongodb://localhost:27017/fansclub",{useUnifiedTopology:!0,useNewUrlParser:!0,useCreateIndex:!0}),g.a.connection.on("connected",(function(){h("MongoDB connected")})),g.a.connection.on("disconnected",(function(){h("MongoDB disconnected")})),g.a.connection.on("reconnected",(function(){h("MongoDB reconnected")})),g.a.connection.on("error",(function(e){h("MongoDB error: ".concat(e))}));var b=r()();b.use(r.a.static(f.a.resolve("react","build"))),b.use(c()()),b.use(u.a.json()),b.use(u.a.urlencoded({extended:!1})),b.use(i()()),b.get("/",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.get("/clubs",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.get("/signup",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.get("/signin",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.get("/map/*",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.get("/map",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.get("/auth/*",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.use("/api/v1",v.a.v1),b.listen(y,(function(){return h("Listening on port ".concat(y))}))}.call(this,"/")},function(e,n){e.exports=require("regenerator-runtime/runtime")},function(e,n){e.exports=require("dotenv/config")},function(e,n){e.exports=require("@mapbox/mbtiles")}]);