!function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(r,o,function(n){return e[n]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="/",t(t.s=13)}([function(e,n){e.exports=require("debug")},function(e,n){e.exports=require("mongoose")},function(e,n){e.exports=require("jsonwebtoken")},function(e,n){e.exports=require("path")},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("@turf/turf")},function(e,n){e.exports=require("mongoose-geojson-schema")},function(e,n){e.exports=require("body-parser")},function(e,n){e.exports=require("fs")},function(e,n){e.exports=require("cookie-parser")},function(e,n){e.exports=require("cors")},function(e,n){e.exports=require("email-validator")},function(e,n,t){"use strict";var r=t(0),o=t.n(r),a=t(4),i=t(11),u=t.n(i);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e){var n={};return new Promise((function(t){e.forEach((function(r,o){r.required&&!r.value?n["".concat(r.name)]="".concat(r.name," is required"):r.minLength&&r.value.length<r.minLength?n["".concat(r.name)]="".concat(r.name," should have more than ").concat(r.minLength," characters"):r.maxLength&&r.value.maxLength>r.maxLength?n["".concat(r.name)]="".concat(r.name," should have less than ").concat(r.maxLength," characters"):r.length&&"object"!==r.type&&r.value.length!==r.length?n["".concat(r.name)]="".concat(r.name," should have ").concat(r.length," characters"):r.type&&s(r.value)!==r.type?n["".concat(r.name)]="".concat(r.name," type should ba ").concat(r.type):r.email&&!1===u.a.validate(r.value)?n["".concat(r.name)]="".concat(r.name," is invalid"):"object"===r.type?r.length&&Object.keys(r.value).length!==r.length&&(n["".concat(r.name)]="".concat(r.name," object length should be ").concat(r.length)):"object"===r.type?r.keys.forEach((function(e){r.value[e.name]||(n["".concat(r.name)]="".concat(e.name," should be a part of ").concat(r.name))})):"object"===r.type&&r.keys.forEach((function(e){s(r.value[e.name])!==e.type&&(n["".concat(r.name)]="".concat(e.name," type should be ").concat(e.type))})),o===e.length-1&&t(n)}))}))}var l=function(e){return c([{value:e.from,name:"from",required:!0,type:"string"},{value:e.email,name:"email",email:!0},{value:e.firstname,name:"firstname",required:!0,type:"string"},{value:e.lastname,name:"lastname",required:!0,type:"string"},{value:e.fullname,name:"fullname",required:!0,type:"string"},{value:e.thumbnail,name:"thumbnail",required:!0,type:"string"},{value:e.googleId||e.facebookId,name:"id",required:!0,type:"string"},{value:e.location,name:"location",required:!0,type:"object",length:2,keys:[{value:"lng",type:"number"},{value:"lat",type:"number"}]},{value:e.address,name:"address",required:!0,type:"string"},{value:e.birth,name:"birth",required:!0},{value:e.gender,name:"gender",required:!0,type:"string"}])},f=t(5),d=t(2),p=t.n(d),m=t(1),g=t.n(m),v=(t(6),new m.Schema({geo:{type:m.Schema.Types.Point,required:!0},address:{type:String,required:!0},email:{type:String,required:!0,unique:!0},fullname:{type:String},firstname:{type:String},lastname:{type:String},thumbnail:{type:String},picture:{type:String},birth:{type:Date,required:!0},gender:{type:String,required:!0},facebookId:{type:String},googleId:{type:String},activatedOn:{type:Date,default:new Date},likes:[{type:m.Schema.Types.ObjectId,ref:"Team"}],dislikes:[{type:m.Schema.Types.ObjectId,ref:"Team"}],suggests:[{type:m.Schema.Types.ObjectId,ref:"Suggest"}]})),h=Object(m.model)("User",v),y=o()("log:db:makeNewuser"),b=function(e,n){y("-------------------------------------------",process.env.TOKEN);var t=e.from,r=e.email,o=e.firstname,a=e.lastname,i=e.fullname,u=e.picture,s=e.thumbnail,c=e.googleId,l=e.facebookId,d=e.location,m=e.address,g=e.birth,v=e.gender,b=f.point([d.lng,d.lat]),x=new h({geo:b.geometry,address:m,email:r,fullname:i,firstname:o,lastname:a,thumbnail:s,picture:u,birth:new Date(g),gender:v});"google"===t&&(x.googleId=c),"facebook"===t&&(x.facebookId=l);try{x.save((function(e,t){return e?(y("save err",e),11e3===e.code?n(500,{other:"email should be unique"}):n(500,{other:"Internal Server Error"})):(p.a.sign({email:t.email,id:t._id},process.env.TOKEN,(function(e,r){return e?(y("error on creating token",e),n(500,{other:"Server Internal Error"})):(y("++++++++++++++++++++++",r),n(200,{token:r,snackMsg:"hello ".concat(t.firstname)}))})),null)}))}catch(e){return y("eeeeeeeeeeeeeeeeeeeeee",e),n(500,{other:"Internal Server Error"})}};function x(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function k(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){x(a,r,o,i,u,"next",e)}function u(e){x(a,r,o,i,u,"throw",e)}i(void 0)}))}}var w=o()("log:v1");function S(){return(S=k(regeneratorRuntime.mark((function e(n,t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("make ne user is :::",n),e.next=3,l(n);case 3:if(r=e.sent,w("test isNewUser",r),!Object.entries(r).length){e.next=7;break}return e.abrupt("return",t(400,{test:r}));case 7:return b(n,(function(e,n){return t(e,n)})),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _=function(e){return c([{value:e,name:"email",required:!0,email:!0}])},O=o()("log:db");function T(e,n){O("gert user by email is working",e),h.findOne({email:e},(function(e,t){return O("getUserByEmail result",e,t),e?n(e,null):n(null,t)}))}function R(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function P(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){R(a,r,o,i,u,"next",e)}function u(e){R(a,r,o,i,u,"throw",e)}i(void 0)}))}}var q=o()("log:v1");function j(){return(j=P(regeneratorRuntime.mark((function e(n,t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.email,e.next=3,_(r);case 3:if(o=e.sent,q("test isNewUser",o),!Object.entries(o).length){e.next=7;break}return e.abrupt("return",t(400,o));case 7:return T(r,(function(e,n){return t(200,e?{err:!0,other:"Internal Server Error"}:n?{err:!0,other:"Account exists"}:{msg:"New User"})})),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=function(e){return c([{value:e,name:"facebook id",required:!0}])};function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}o()("log:db");function E(e,n){console.log("-----",C(e)),console.log("gert user by facebookId is working",e),h.findOne(e,(function(e,t){return console.log("getUserByFacebookID result",e,t),e?n(e,null):n(null,t)}))}function A(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function D(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){A(a,r,o,i,u,"next",e)}function u(e){A(a,r,o,i,u,"throw",e)}i(void 0)}))}}var N=o()("log:v1");function U(){return(U=D(regeneratorRuntime.mark((function e(n,t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.facebookId,e.next=3,I(r);case 3:if(o=e.sent,N("test isNewUser",o),!Object.entries(o).length){e.next=7;break}return e.abrupt("return",t(400,o));case 7:return E({facebookId:r},(function(e,n){return t(200,e?{err:!0,other:"Internal Server Error"}:n?{err:!0,other:"Account exists"}:{msg:"New User"})})),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}o()("log:db");function L(e,n){h.findById(e).populate("likes").populate("dislikes").exec((function(e,t){return e?n(e,null):(console.log({result:t}),n(null,t))}))}var $=o()("log:db");function M(e,n){$("gert user by email is working",e);var t={};Object.facebookId?t.facebookId=e.facebookId:t.googleId=e.googleId,h.findOne(t).exec((function(e,t){if(e)return n(e,null);L(t.id,(function(e,t){return e?n(500,{other:"Server Internal Error"}):t?n(null,{snackMsg:"hello ".concat(t.firstname),firstname:t.firstname,lastname:t.lastname,likes:t.likes||null,dislikes:t.dislikes||null,suggests:t.suggests||null,location:t.geo,thumbnail:t.thumbnail,address:t.address,_id:t._id,email:t.email}):n(400,"User doesnt exist")}))}))}function B(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function F(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){B(a,r,o,i,u,"next",e)}function u(e){B(a,r,o,i,u,"throw",e)}i(void 0)}))}}var W=o()("log:v1");function K(){return(K=F(regeneratorRuntime.mark((function e(n,t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.facebookId,o=n.googleId,M({facebookId:r,googleId:o},(function(e,n){return W("result of population ==> ",e,n),e?t(500,{other:"Server Internal Error"}):n?(p.a.sign({email:n.email,id:n._id},process.env.TOKEN,(function(r,o){return e?(W("error on creating token",r),t(500,{other:"Server Internal Error"})):(W("user is : ",{user:n}),console.log("user is : ",{user:n}),t(200,{token:o,snackMsg:"hello ".concat(n.firstname,", you signed in with ").concat(n.email),firstname:n.firstname,lastname:n.lastname,likes:n.likes||null,dislikes:n.dislikes||null,suggests:n.suggests||null,location:n.geo,from:n.googleId?"google":"facebook",thumbnail:n.thumbnail,address:n.address}))})),null):t(400,{other:"no user has been found"})})),e.abrupt("return",null);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var H=o()("log:v1");var X=function(e){return c([{value:e.str,name:"str",required:!0,type:"string"}])},G=new m.Schema({group:{type:String,required:!0},country:{type:String,required:!0},name:{type:String,required:!0},city:{type:String},primary_color:{type:String,required:!0},secondary_color:{type:String,required:!0}});G.index({name:1});var z=Object(m.model)("Team",G);o()("log:db");function J(e,n){z.find({name:{$regex:"^".concat(e,".*"),$options:"i"}}).sort({name:1}).limit(10).exec((function(e,t){e?n(e,null):n(null,t)}))}function Q(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function V(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){Q(a,r,o,i,u,"next",e)}function u(e){Q(a,r,o,i,u,"throw",e)}i(void 0)}))}}o()("log:v1");function Y(){return(Y=V(regeneratorRuntime.mark((function e(n,t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(n);case 2:if(r=e.sent,!Object.entries(r).length){e.next=5;break}return e.abrupt("return",t(400,{test:r}));case 5:return J(n.str,(function(e,n){return e?t(500,{other:"Server Internal Error"}):t(200,{clubs:n})})),e.abrupt("return",null);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=new m.Schema({geo:m.Schema.Types.Point,user_id:{type:String},boundy_id:{type:String},team_id:{type:String},name0:{type:String},name1:{type:String},name2:{type:String},fid:{type:Number,require:!0},date:{type:Date,default:new Date},gender:{type:String}});Z.index({geo:"2dsphere"}),Z.index({user_id:1}),Z.index({boundy_id:1}),Z.index({team_id:1}),Z.index({fid:1}),Z.index({date:1}),Z.index({gender:1});var ee=Object(m.model)("Like",Z),ne=function(e){return c([{value:e.token,name:"token",required:!0,type:"string"},{value:e.club,name:"club",required:!0,type:"object",keys:[{value:"_id",type:"string"},{value:"group",type:"string"},{value:"name",type:"string"},{value:"city",type:"string"},{value:"primary_color",type:"string"},{value:"secondary_color",type:"string"}]}])},te=new m.Schema({name0:{type:String},name1:{type:String},name2:{type:String},geo:m.Schema.Types.MultiPolygon,fid:{type:Number,required:!0}});te.index({geo:"2dsphere"}),te.index({fid:1});var re=Object(m.model)("GeoJSON",te);function oe(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function ae(e,n){re.find({geo:{$geoIntersects:{$geometry:{type:e.type,coordinates:e.coordinates}}}},function(){var e,t=(e=regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return",n(t,{msg:"Server Internal Error"}));case 2:return e.abrupt("return",n(null,{array:r}));case 3:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){oe(a,r,o,i,u,"next",e)}function u(e){oe(a,r,o,i,u,"throw",e)}i(void 0)}))});return function(e,n){return t.apply(this,arguments)}}())}function ie(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function ue(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){ie(a,r,o,i,u,"next",e)}function u(e){ie(a,r,o,i,u,"throw",e)}i(void 0)}))}}var se=o()("log:v1");function ce(){return(ce=ue(regeneratorRuntime.mark((function e(n,t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne(n);case 2:if(r=e.sent,se("test searchClubs",r),!Object.entries(r).length){e.next=6;break}return e.abrupt("return",t(400,{test:r}));case 6:return o=n.token,p.a.verify(o,process.env.TOKEN,(function(e,r){if(e)return t(500,{other:"Server Internal Error"});L(r.id,function(){var e=ue(regeneratorRuntime.mark((function e(r,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se("----------------------",o),!r){e.next=3;break}return e.abrupt("return",t(500,{other:"Server Internal Error"}));case 3:if(o){e.next=5;break}return e.abrupt("return",t(400,"User doesnt exist"));case 5:if(!(o.likes.length>=5)){e.next=7;break}return e.abrupt("return",t(403,"you can like more than 5 clubs"));case 7:return e.next=9,o.likes.find((function(e){return e._id==n.club._id}));case 9:if(!e.sent){e.next=12;break}return e.abrupt("return",t(403,{other:"you already liked this club"}));case 12:return e.next=14,o.dislikes.find((function(e){return e._id==n.club._id}));case 14:if(!e.sent){e.next=17;break}return e.abrupt("return",t(403,{other:"you can likes clubs you already disliked"}));case 17:return ae(o.geo,function(){var e=ue(regeneratorRuntime.mark((function e(r,a){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se("findBoundries",o.geo,r,a),!r){e.next=3;break}return e.abrupt("return",t(500,{other:"Server Internal Error"}));case 3:if(a.array.length){e.next=5;break}return e.abrupt("return",t(400,{msg:"unable to resolve coordinates"}));case 5:return e.next=7,g.a.startSession();case 7:return(i=e.sent).startTransaction(),e.prev=9,e.next=12,a.array.forEach((function(e){new ee({name0:e.name0,name1:e.name1,name2:e.name2,user_id:o._id,boundy_id:e._id,team_id:n.club._id,geo:o.geo,fid:e.fid,gender:o.gender}).save()}));case 12:return o.likes.push(n.club._id),e.next=15,o.save();case 15:return e.next=17,i.commitTransaction();case 17:return e.next=19,i.endSession();case 19:return e.abrupt("return",null);case 22:return e.prev=22,e.t0=e.catch(9),e.next=26,i.abortTransaction();case 26:return i.endSession(),e.abrupt("return",t(500,{msg:"internal error"}));case 28:return e.prev=28,L(o._id,(function(e,n){return e?t(500,{msg:"internal error"}):t(200,{snackMsg:"hello ".concat(n.firstname),firstname:n.firstname,lastname:n.lastname,likes:n.likes||null,dislikes:n.dislikes||null,suggests:n.suggests||null,location:n.geo})})),e.finish(28);case 31:case"end":return e.stop()}}),e,null,[[9,22,28,31]])})));return function(n,t){return e.apply(this,arguments)}}()),e.abrupt("return",null);case 19:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}())})),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var le=new m.Schema({geo:m.Schema.Types.Point,user_id:{type:String},boundy_id:{type:String},team_id:{type:String},name0:{type:String},name1:{type:String},name2:{type:String},fid:{type:Number,require:!0},date:{type:Date,default:new Date},gender:{type:String}});le.index({geo:"2dsphere"}),le.index({user_id:1}),le.index({boundy_id:1}),le.index({team_id:1}),le.index({fid:1}),le.index({date:1}),le.index({gender:1});var fe=Object(m.model)("Dislike",le);function de(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function pe(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){de(a,r,o,i,u,"next",e)}function u(e){de(a,r,o,i,u,"throw",e)}i(void 0)}))}}var me=o()("log:v1"),ge=function(e){return c([{value:e.token,name:"token",required:!0,type:"string"},{value:e.club,name:"club",required:!0,type:"object",keys:[{value:"_id",type:"string"},{value:"group",type:"string"},{value:"name",type:"string"},{value:"city",type:"string"},{value:"primary_color",type:"string"},{value:"secondary_color",type:"string"}]}])};function ve(){return(ve=pe(regeneratorRuntime.mark((function e(n,t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ge(n);case 2:if(r=e.sent,me("test searchClubs",r),!Object.entries(r).length){e.next=6;break}return e.abrupt("return",t(400,{test:r}));case 6:return o=n.token,p.a.verify(o,process.env.TOKEN,(function(e,r){if(e)return t(500,{other:"Server Internal Error"});L(r.id,function(){var e=pe(regeneratorRuntime.mark((function e(r,o){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=2;break}return e.abrupt("return",t(500,{other:"Server Internal Error"}));case 2:if(o){e.next=4;break}return e.abrupt("return",t(400,"User doesnt exist"));case 4:if(!(o.dislikes.length>=5)){e.next=6;break}return e.abrupt("return",t(403,"you can dislike more than 5 clubs"));case 6:return e.next=8,o.likes.find((function(e){return e._id==n.club._id}));case 8:if(!e.sent){e.next=11;break}return e.abrupt("return",t(403,{other:'you can"t dislikes clubs you already liked'}));case 11:return e.next=13,o.dislikes.find((function(e){return e._id==n.club._id}));case 13:if(!e.sent){e.next=16;break}return e.abrupt("return",t(403,{other:"you already disliked this club"}));case 16:return ae(o.geo,function(){var e=pe(regeneratorRuntime.mark((function e(r,a){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(me("findBoundries",o.geo,r,a),!r){e.next=3;break}return e.abrupt("return",t(500,{other:"Server Internal Error"}));case 3:if(a.array.length){e.next=5;break}return e.abrupt("return",t(400,{msg:"unable to resolve coordinates"}));case 5:return e.next=7,g.a.startSession();case 7:return(i=e.sent).startTransaction(),e.prev=9,e.next=12,a.array.forEach((function(e){new fe({name0:e.name0,name1:e.name1,name2:e.name2,user_id:o._id,boundy_id:e._id,team_id:n.club._id,geo:o.geo,fid:e.fid,gender:o.gender}).save()}));case 12:return o.dislikes.push(n.club._id),e.next=15,o.save();case 15:return e.next=17,i.commitTransaction();case 17:return e.next=19,i.endSession();case 19:return e.abrupt("return",null);case 22:return e.prev=22,e.t0=e.catch(9),e.next=26,i.abortTransaction();case 26:return i.endSession(),e.abrupt("return",t(500,{msg:"internal error"}));case 28:return e.prev=28,L(o._id,(function(e,n){return e?t(500,{msg:"internal error"}):t(200,{snackMsg:"hello ".concat(n.firstname),firstname:n.firstname,lastname:n.lastname,likes:n.likes||null,dislikes:n.dislikes||null,suggests:n.suggests||null,location:n.geo})})),e.finish(28);case 31:case"end":return e.stop()}}),e,null,[[9,22,28,31]])})));return function(n,t){return e.apply(this,arguments)}}()),e.abrupt("return",null);case 18:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}())})),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function ye(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){he(a,r,o,i,u,"next",e)}function u(e){he(a,r,o,i,u,"throw",e)}i(void 0)}))}}var be=o()("log:v1");function xe(e,n,t,r){return new Promise((function(o,a){"like"===t?ee.countDocuments({team_id:n,gender:r,date:{$gte:new Date(e[0]),$lte:new Date(e[1])}}).exec((function(e,n){e&&(be("geoWithin err",e),a(e)),o(n)})):fe.countDocuments({team_id:n,gender:r,date:{$gte:new Date(e[0]),$lte:new Date(e[1])}}).exec((function(e,n){e&&(be("geoWithin err",e),a(e)),o(n)}))}))}var ke=t(8),we=t.n(ke),Se=new m.Schema({country:{type:String},name:{type:String},geo:m.Schema.Types.Point,cn:{type:String,unique:!0}});Se.index({geo:"2dsphere"}),Se.index({name:1}),Se.index({country:1}),Se.index({cn:1});var _e=Object(m.model)("City",Se);function Oe(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function Te(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){Oe(a,r,o,i,u,"next",e)}function u(e){Oe(a,r,o,i,u,"throw",e)}i(void 0)}))}}o()("log:v1");var Re=function(e,n,t){return new Promise((function(r){we.a.readFile("/root/repos/fans_club/routes/logo/".concat(e+n+t,".png"),(function(o,a){a?(console.log("imaaaaaaaaaaage found"),r(a)):we.a.readFile("/root/repos/fans_club/routes/logo/".concat(e+n+t,".jpg"),(function(e,n){n?(console.log("imaaaaaaaaaaage found"),r(n)):r("")}))}))}))};var Pe=o()("log:v1__serverTiles"),qe=t(16),je={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/x-protobuf"},Ie={"Content-Type":"text/plain"};o()("log:v1");function Ce(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}o()("log:v1");function Ee(e){var n=e.likeOrDislike,t=e.reducedDuplicates,r=e.teamId,o={},a=function(e){return e<1e3?e:e<1e4?e+1e3:e+1e4};return new Promise((function(e,i){try{t.forEach(function(){var i,u=(i=regeneratorRuntime.mark((function i(u,s){var c,l;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if("like"!==n){i.next=7;break}return c=a(u),console.log(c),i.next=5,ee.countDocuments({fid:c,team_id:r},(function(e,n){e&&console.log(e),o[u]=n}));case 5:i.next=11;break;case 7:return l=a(u),console.log(l),i.next=11,fe.countDocuments({fid:l,team_id:r},(function(e,n){e&&console.log(e),o[u]=n}));case 11:t.length-1===s&&e(o);case 12:case"end":return i.stop()}}),i)})),function(){var e=this,n=arguments;return new Promise((function(t,r){var o=i.apply(e,n);function a(e){Ce(o,t,r,a,u,"next",e)}function u(e){Ce(o,t,r,a,u,"throw",e)}a(void 0)}))});return function(e,n){return u.apply(this,arguments)}}())}catch(e){i(e)}}))}function Ae(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function De(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){Ae(a,r,o,i,u,"next",e)}function u(e){Ae(a,r,o,i,u,"throw",e)}i(void 0)}))}}o()("log:v1");function Ne(){return(Ne=De(regeneratorRuntime.mark((function e(n,t){var r,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.token,o=n.club,a=n.type,p.a.verify(r,process.env.TOKEN,(function(e,n){if(e)return t(500,{other:"Server Internal Error"});L(n.id,function(){var e=De(regeneratorRuntime.mark((function e(n,r){var i,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=2;break}return e.abrupt("return",t(500,{other:"Server Internal Error"}));case 2:if(r){e.next=4;break}return e.abrupt("return",t(400,"User doesnt exist"));case 4:return e.next=6,g.a.startSession();case 6:return(i=e.sent).startTransaction(),e.prev=8,e.next=11,r.save();case 11:if("like"!==a){e.next=21;break}return e.next=14,r.likes.filter((function(e){return e._id!=o._id}));case 14:return u=e.sent,r.likes=u,e.next=18,r.save();case 18:return e.next=20,ee.deleteMany({user_id:r._id,team_id:o._id});case 20:L(r._id,(function(e,n){return e?t(500,{msg:"internal error"}):t(200,{firstname:n.firstname,lastname:n.lastname,likes:n.likes||null,dislikes:n.dislikes||null,suggests:n.suggests||null,location:n.geo})}));case 21:if("dislike"!==a){e.next=31;break}return e.next=24,r.dislikes.filter((function(e){return e._id!=o._id}));case 24:return s=e.sent,r.dislikes=s,e.next=28,r.save();case 28:return e.next=30,fe.deleteMany({user_id:r._id,team_id:o._id});case 30:L(r._id,(function(e,n){return e?t(500,{msg:"internal error"}):t(200,{firstname:n.firstname,lastname:n.lastname,likes:n.likes||null,dislikes:n.dislikes||null,suggests:n.suggests||null,location:n.geo})}));case 31:return e.next=33,i.commitTransaction();case 33:return e.next=35,i.endSession();case 35:e.next=43;break;case 37:return e.prev=37,e.t0=e.catch(8),e.next=41,i.abortTransaction();case 41:return i.endSession(),e.abrupt("return",t(500,{msg:"internal error"}));case 43:case"end":return e.stop()}}),e,null,[[8,37]])})));return function(n,t){return e.apply(this,arguments)}}())})),e.abrupt("return",null);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ue(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function Le(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){Ue(a,r,o,i,u,"next",e)}function u(e){Ue(a,r,o,i,u,"throw",e)}i(void 0)}))}}var $e=function(e){return new Promise((function(n,t){Le(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,g.a.startSession();case 2:n.sent.startTransaction();try{p.a.verify(e.token,process.env.TOKEN,function(){var n=Le(regeneratorRuntime.mark((function n(t,r){var o,a,i,u,s,c,l,d,p,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,h.findById(r.id).exec();case 2:return o=n.sent,a=f.point([e.UserLocation.location.lng,e.UserLocation.location.lat]),o.geo=a.geometry,o.address=e.UserLocation.address,n.next=8,o.save();case 8:return n.next=10,re.find({geo:{$geoIntersects:{$geometry:{type:a.geometry.type,coordinates:a.geometry.coordinates}}}}).exec();case 10:return i=n.sent,console.log("boundries --- ",i),n.next=14,i.filter((function(e){return!e.name1&&!e.name2}))[0];case 14:return u=n.sent,n.next=17,i.filter((function(e){return e.name1&&!e.name2}))[0];case 17:return s=n.sent,n.next=20,i.filter((function(e){return e.name1&&e.name2}))[0];case 20:return c=n.sent,n.next=23,ee.find({user_id:r.id}).exec();case 23:return l=n.sent,d=l.filter((function(e){return!e.name1&&!e.name2})),p=l.filter((function(e){return e.name1&&!e.name2})),m=l.filter((function(e){return e.name1&&e.name2})),console.log("++++++++++++++++",d),n.next=30,d.forEach(function(){var e=Le(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.fid=u.fid,n.name0=u.name0,console.log("-------------------------",n),e.next=5,n.save();case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 30:return n.next=32,p.forEach(function(){var e=Le(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.fid=s.fid,n.name0=s.name0,n.name1=s.name1,console.log("-------------------------",n),e.next=6,n.save();case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 32:return n.next=34,m.forEach(function(){var e=Le(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.fid=c.fid,n.name0=c.name0,n.name1=c.name1,n.name2=c.name2,console.log("-------------------------",n),e.next=7,n.save();case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 34:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}catch(e){console.log(e)}case 5:case"end":return n.stop()}}),n)})))()}))},Me=new m.Schema({username:{type:String},password:{type:String}}),Be=Object(m.model)("Admin",Me);function Fe(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function We(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){Fe(a,r,o,i,u,"next",e)}function u(e){Fe(a,r,o,i,u,"throw",e)}i(void 0)}))}}function Ke(){return(Ke=We(regeneratorRuntime.mark((function e(n,t,r){var o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("=============",n,t),n&&t){e.next=3;break}return e.abrupt("return",r(200,{err:!0,other:"bad request"}));case 3:return o={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},a={"Content-Type":"text/plain"},Be.findOne({username:n,password:t},(function(e,i){return console.log("************ ",e,i),e?r(200,a,{err:!0,other:"server internal error"}):i?void p.a.sign({username:n,password:t},process.env.TOKEN,(function(e,n){return e?r(200,a,{err:!0,other:"internal server error"}):(console.log(n),r(200,o,{err:!1,token:n}))})):r(200,a,{err:!0,other:"no uwer had been found"})})),e.abrupt("return",null);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function He(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function Xe(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){He(a,r,o,i,u,"next",e)}function u(e){He(a,r,o,i,u,"throw",e)}i(void 0)}))}}function Ge(){return(Ge=Xe(regeneratorRuntime.mark((function e(n,t){var r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",t(200,{err:!0,other:"bad request"}));case 2:return r={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},o={"Content-Type":"text/plain"},p.a.verify(n,process.env.TOKEN,(function(e,n){if(console.log(e,n),e)return t(200,o,{err:!0,other:"internal server error"});Be.findOne({username:n.username},(function(e,n){return e?t(200,o,{err:!0,other:"internal server error"}):n?t(200,r,{err:!1,isAdmin:!0}):t(200,o,{err:!0,other:"no user had been fround"})}))})),e.abrupt("return",null);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ze=Object(a.Router)();ze.get("/verify/:username/:password",(function(e,n){!function(e,n,t){Ke.apply(this,arguments)}(e.params.username,e.params.password,(function(e,t,r){n.set(t).status(e).send({trace:r})}))})),ze.get("/verifyByToken/:token",(function(e,n){console.log("got the req",e.params.token),function(e,n){Ge.apply(this,arguments)}(e.params.token,(function(e,t,r){n.set(t).status(e).send({trace:r})}))}));var Je=ze;function Qe(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}var Ve={"Content-Type":"text/plain"},Ye=function(){var e,n=(e=regeneratorRuntime.mark((function e(n,t,r){var o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.params||n.body,a=o.token,console.log("-_________________",a),p.a.verify(a,process.env.TOKEN,(function(e,n){console.log(e,n),e&&t.set(Ve).status(200).send({err:!0,other:"internal server error"}),Be.findOne({username:n.username},(function(e,n){e&&t.set(Ve).status(200).send({err:!0,other:"internal server error"}),n||t.set(Ve).status(200).send({err:!0,other:"no user had been fround"}),r()}))}));case 3:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){Qe(a,r,o,i,u,"next",e)}function u(e){Qe(a,r,o,i,u,"throw",e)}i(void 0)}))});return function(e,t,r){return n.apply(this,arguments)}}();function Ze(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function en(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){Ze(a,r,o,i,u,"next",e)}function u(e){Ze(a,r,o,i,u,"throw",e)}i(void 0)}))}}var nn={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},tn={"Content-Type":"text/plain"};function rn(){return(rn=en(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:z.countDocuments({},(function(e,t){return e?n(200,tn,{err:!0,other:"internal server error"}):n(200,nn,{err:!1,count:t})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function on(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function an(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){on(a,r,o,i,u,"next",e)}function u(e){on(a,r,o,i,u,"throw",e)}i(void 0)}))}}var un={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},sn={"Content-Type":"text/plain"};function cn(){return(cn=an(regeneratorRuntime.mark((function e(n,t){var r,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("--------------------",n),e.prev=1,e.next=4,ee.countDocuments({team_id:n,fid:{$lt:1e3}});case 4:return r=e.sent,e.next=7,fe.countDocuments({team_id:n,fid:{$lt:1e3}});case 7:return o=e.sent,e.next=10,ee.find({team_id:n,fid:{$lt:1e3}}).sort({date:1}).limit(10).exec();case 10:return a=e.sent,e.next=13,fe.find({team_id:n,fid:{$lt:1e3}}).sort({date:1}).limit(10).exec();case 13:return i=e.sent,console.log({countDislikes:o,countLikes:r,latestDislikes:i,latestLikes:a}),e.abrupt("return",t(200,un,{err:!1,countDislikes:o,countLikes:r,latestDislikes:i,latestLikes:a}));case 18:return e.prev=18,e.t0=e.catch(1),e.abrupt("return",t(200,sn,{err:!0,other:"internal server error"}));case 21:case"end":return e.stop()}}),e,null,[[1,18]])})))).apply(this,arguments)}function ln(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function fn(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var dn=Object(a.Router)();dn.get("/count/:token",Ye,(function(e,n){console.log("got the req"),function(e){rn.apply(this,arguments)}((function(e,t,r){n.set(t).status(e).send({trace:r})}))})),dn.get("/details/:teamId/:token",Ye,(function(e,n){console.log("got the req"),function(e,n){cn.apply(this,arguments)}(e.params.teamId,(function(e,t,r){n.set(t).status(e).send(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?ln(Object(t),!0).forEach((function(n){fn(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ln(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},r))}))}));var pn=dn;function mn(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function gn(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){mn(a,r,o,i,u,"next",e)}function u(e){mn(a,r,o,i,u,"throw",e)}i(void 0)}))}}var vn={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},hn={"Content-Type":"text/plain"};function yn(){return(yn=gn(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h.countDocuments({},(function(e,t){return e?n(200,hn,{err:!0,other:"internal server error"}):n(200,vn,{err:!1,count:t})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var bn=Object(a.Router)();bn.get("/count/:token",Ye,(function(e,n){console.log("got the req"),function(e){yn.apply(this,arguments)}((function(e,t,r){n.set(t).status(e).send({trace:r})}))}));var xn=bn;function kn(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function wn(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){kn(a,r,o,i,u,"next",e)}function u(e){kn(a,r,o,i,u,"throw",e)}i(void 0)}))}}var Sn={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},_n={"Content-Type":"text/plain"};function On(){return(On=wn(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ee.countDocuments({},(function(e,t){return e?n(200,_n,{err:!0,other:"internal server error"}):n(200,Sn,{err:!1,count:t})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Tn=Object(a.Router)();Tn.get("/count/:token",Ye,(function(e,n){console.log("got the req"),function(e){On.apply(this,arguments)}((function(e,t,r){n.set(t).status(e).send({trace:r})}))}));var Rn=Tn;function Pn(e,n,t,r,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void t(e)}u.done?n(s):Promise.resolve(s).then(r,o)}function qn(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){Pn(a,r,o,i,u,"next",e)}function u(e){Pn(a,r,o,i,u,"throw",e)}i(void 0)}))}}var jn={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept","Content-Type":"application/json"},In={"Content-Type":"text/plain"};function Cn(){return(Cn=qn(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fe.countDocuments({},(function(e,t){return e?n(200,In,{err:!0,other:"internal server error"}):n(200,jn,{err:!1,count:t})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var En=Object(a.Router)();En.get("/count/:token",Ye,(function(e,n){console.log("got the req"),function(e){Cn.apply(this,arguments)}((function(e,t,r){n.set(t).status(e).send({trace:r})}))}));var An=En,Dn=o()("log:v1"),Nn=Object(a.Router)();Nn.post("/POST/makeNewUser",(function(e,n){!function(e,n){S.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Nn.post("/POST/isUserNew",(function(e,n){!function(e,n){j.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Nn.post("/POST/isUserNewFb",(function(e,n){!function(e,n){U.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Nn.post("/POST/signin",(function(e,n){!function(e,n){K.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Nn.get("/GET/getUserInfo/:token",(function(e,n){var t,r;Dn("getUesrInfo token is ==> ",e.params.token),t=e.params.token,r=function(e,t){n.status(e).send(t)},p.a.verify(t,process.env.TOKEN,(function(e,n){if(H("??????",e,n),e)return r(500,{other:"Server Internal Error"});L(n.id,(function(e,n){return e?r(500,{other:"Server Internal Error"}):n?r(200,{snackMsg:"hello ".concat(n.firstname),firstname:n.firstname,lastname:n.lastname,likes:n.likes||null,dislikes:n.dislikes||null,suggests:n.suggests||null,location:n.geo,thumbnail:n.thumbnail,address:n.address}):r(400,"User doesnt exist")}))}))})),Nn.post("/POST/searchClubs",(function(e,n){console.log(e.body),function(e,n){Y.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Nn.post("/POST/likeClub",(function(e,n){!function(e,n){ce.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Nn.post("/POST/dislikeClub",(function(e,n){!function(e,n){ve.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Nn.get("/GET/getClubTotalLikes/:mode/:id",(function(e,n){!function(e,n,t){var r=17424e5,o=[1580114579e3,1581856979e3],a=[o[1],o[1]+r],i=[a[1],a[1]+r],u=[i[1],i[1]+r],s=[u[1],u[1]+r],c=[s[1],s[1]+r];try{ye(regeneratorRuntime.mark((function r(){var l,f,d;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,ye(regeneratorRuntime.mark((function t(){var r,l,f,d,p,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,xe(o,e,n,"male");case 2:return r=t.sent,t.next=5,xe(a,e,n,"male");case 5:return t.t0=t.sent,t.t1=r,l=t.t0+t.t1,t.next=10,xe(i,e,n,"male");case 10:return t.t2=t.sent,t.t3=l,f=t.t2+t.t3,t.next=15,xe(u,e,n,"male");case 15:return t.t4=t.sent,t.t5=f,d=t.t4+t.t5,t.next=20,xe(s,e,n,"male");case 20:return t.t6=t.sent,t.t7=d,p=t.t6+t.t7,t.next=25,xe(c,e,n,"male");case 25:return t.t8=t.sent,t.t9=p,m=t.t8+t.t9,t.abrupt("return",[r,l,f,d,p,m]);case 29:case"end":return t.stop()}}),t)})))();case 2:return l=r.sent,r.next=5,ye(regeneratorRuntime.mark((function t(){var r,l,f,d,p,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,xe(o,e,n,"female");case 2:return r=t.sent,t.next=5,xe(a,e,n,"female");case 5:return t.t0=t.sent,t.t1=r,l=t.t0+t.t1,t.next=10,xe(i,e,n,"female");case 10:return t.t2=t.sent,t.t3=l,f=t.t2+t.t3,t.next=15,xe(u,e,n,"female");case 15:return t.t4=t.sent,t.t5=f,d=t.t4+t.t5,t.next=20,xe(s,e,n,"female");case 20:return t.t6=t.sent,t.t7=d,p=t.t6+t.t7,t.next=25,xe(c,e,n,"female");case 25:return t.t8=t.sent,t.t9=p,m=t.t8+t.t9,t.abrupt("return",[r,l,f,d,p,m]);case 29:case"end":return t.stop()}}),t)})))();case 5:return f=r.sent,r.next=8,z.findById(e,(function(e,n){return e?t(500,{msg:"Internal Serever Error"}):n}));case 8:return d=r.sent,r.abrupt("return",t(200,{males:l,females:f,team:d}));case 10:case"end":return r.stop()}}),r)})))()}catch(e){return be(e),t(500,{msg:"Internal Serever Error"})}}(e.params.id,e.params.mode,(function(e,t){n.status(e).send(t)}))})),Nn.get("/GET/tiles/:z/:x/:y",(function(e,n){var t=e.params;!function(e,n,t,r){console.log(e,n,t),new qe(e<4?"./mbTiles/0.mbtiles":e<7?"./mbTiles/1.mbtiles":"./mbTiles/2.mbtiles",(function(o,a){a.getTile(e,n,t,(function(e,n){return e?(Pe(e),r(404,Ie,"Tile rendering error: ".concat(e,"\n"))):r(200,je,n)}))}))}(t.z,t.x,t.y,(function(e,t,r){200===e?n.set(t).status(e).send(r):n.sendStatus(204)}))})),Nn.get("/GET/membersFromPoly/:swlng/:swlat/:nelng/:nelat/:val/:teamId",(function(e,n){var t=e.params;!function(e,n,t,r,o,a,i){var u=[e,n,t,r],s=f.bboxPolygon(u);"like"===o?ee.find({team_id:a,geo:{$geoWithin:{$geometry:s.geometry}}},(function(e,n){return console.log(n),e?i(500,{msg:"Inernal Server Error"}):i(200,{likes:n})})):fe.find({team_id:a,geo:{$geoWithin:{$geometry:s.geometry}}},(function(e,n){return console.log(n),e?i(500,{msg:"Inernal Server Error"}):i(200,{likes:n})}))}(t.swlng,t.swlat,t.nelng,t.nelat,t.val,t.teamId,(function(e,t){n.status(e).send(t)}))})),Nn.post("/POST/getLikesForPolys",(function(e,n){var t,r;t=e.body,r=function(e,t){n.status(e).send(t)},Ee(t).then((function(e){return console.time("process is done"),r(200,{likes:e})})).catch((function(e){return r(500,{msg:"Internal Server Error",e:e})}))})),Nn.get("/GET/club/:clubId",(function(e,n){var t,r;console.log("_____",e.params),t=e.params.clubId,r=function(e,t){n.status(e).send(t)},console.log(t),z.findById(t,function(){var e=Te(regeneratorRuntime.mark((function e(n,t){var o,a,i,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=3;break}return console.log("error on finding club \n ".concat(n)),e.abrupt("return",r(500,"error on finding club"));case 3:if(console.log("club ==> ",t),o=t.city,t.group,a=t.country,i=t.name,!(a&&o&&i)){e.next=15;break}return e.next=8,Re(a,o,i);case 8:if(u=e.sent,console.log("img :::: ",u),u){e.next=12;break}return e.abrupt("return",r(200,{club:t,errRead:"not found logo"}));case 12:_e.findOne({name:o.trim()},function(){var e=Te(regeneratorRuntime.mark((function e(n,o){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=3;break}return console.log("--------------- finding City",n),e.abrupt("return",r(200,{club:t,errCity:n}));case 3:if(o){e.next=6;break}return console.log("--------------- no city has been found",o),e.abrupt("return",r(200,{club:t,errCity:null}));case 6:return a=Buffer.from(u).toString("base64"),e.abrupt("return",r(200,{city:o,club:t,base64Image:a}));case 8:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()),e.next=16;break;case 15:return e.abrupt("return",r(200,t));case 16:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}())})),Nn.post("/POST/deleteClub",(function(e,n){!function(e,n){Ne.apply(this,arguments)}(e.body,(function(e,t){n.status(e).send(t)}))})),Nn.post("/POST/changeUserLocation",(function(e,n){$e(e.body),n.send("done")})),Nn.use("/admin",Je),Nn.use("/clubs",pn),Nn.use("/users",xn),Nn.use("/likes",Rn),Nn.use("/dislikes",An);var Un=Nn;n.a={v1:Un}},function(e,n,t){"use strict";t.r(n),function(e){t(14);var n=t(4),r=t.n(n),o=t(9),a=t.n(o),i=t(7),u=t.n(i),s=t(10),c=t.n(s),l=t(3),f=t.n(l),d=t(0),p=t.n(d),m=t(1),g=t.n(m),v=(t(15),t(12)),h=p()("server"),y=process.env.PORT||4e3;g.a.connect("mongodb://localhost:27017/fansclub",{useUnifiedTopology:!0,useNewUrlParser:!0,useCreateIndex:!0}),g.a.connection.on("connected",(function(){h("MongoDB connected")})),g.a.connection.on("disconnected",(function(){h("MongoDB disconnected")})),g.a.connection.on("reconnected",(function(){h("MongoDB reconnected")})),g.a.connection.on("error",(function(e){h("MongoDB error: ".concat(e))}));var b=r()();b.use(r.a.static(f.a.resolve("react","build"))),b.use(c()()),b.use(u.a.json()),b.use(u.a.urlencoded({extended:!1})),b.use(a()()),b.get("/",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.get("/clubs",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.get("/signup",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.get("/signin",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.get("/map/*",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.get("/map",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.get("/auth/*",(function(n,t){console.log(e),console.log("got the req address :: ",f.a.join(e,"react","build","index.html")),t.sendFile(f.a.resolve("react","build","index.html"))})),b.use("/api/v1",v.a.v1),b.listen(y,(function(){return h("Listening on port ".concat(y))}))}.call(this,"/")},function(e,n){e.exports=require("regenerator-runtime/runtime")},function(e,n){e.exports=require("dotenv/config")},function(e,n){e.exports=require("@mapbox/mbtiles")}]);